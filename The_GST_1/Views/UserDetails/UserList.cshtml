@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model IEnumerable<Repository_Logic.ModelView.UserModelView>
<style>

    .dropdown1 {
        display: inline-block;
        position:;
    }

    .dropdown1 {
        background-position-x: right;
        background-position-y: right;
    }

    .dropdown-content1 {
        display: none;
        position: absolute;
        width: 100%;
        overflow: auto;
        box-shadow: 0px 10px 10px 0px rgba(0,0,0,0.4);
    }

    .dropdown1:hover .dropdown-content1 {
        display: block;
    }

    .dropdown1-content a {
        display: block;
        color: #FFFFFF;
        padding: 5px;
        text-decoration: none;
    }

        .dropdown1-content a:hover {
            color: #FFFFFF;
            background-color: #FFFFFF;
        }





    .dropdown1 {
        display: inline-block;
        position: relative;
    }

    .dropdown-content1 {
        display: none;
        position: absolute;
        width: 100%;
        overflow: auto;
        box-shadow: 0px 10px 10px 0px rgba(0,0,0,0.4);
    }

    .dropdown1:hover .dropdown-content1 {
        display: block;
    }

    .dropdown-content1 a {
        display: block;
        color: #ffffff;
        padding: 5px;
        text-decoration: blink;
    }

        .dropdown-content1 a:hover {
            color: #FFFFFF;
            background-color: green;
        }

    /* .row {
            margin-left: 10px;
        }*/
    /* .aa{

               font-size:202px;
            }*/
</style>

<!-- Your table code -->










    <!-- Custom fonts for this template -->

@*<link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
*@
<br />

    <a class="back-button" id="register" style=" margin-left: 82%;" asp-area="Identity" asp-page="/Account/Register">




        <span><i class="fa-solid fa-user"></i>Add New User</span>
    </a>


<br />
<div class="container-fluid">
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary" style="font-size:20px">User List</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
                    <!-- DataTales Example -->

                    <table class="table table-bordered" id="dataTableUser">
                                    <thead>
                                        <tr>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.FirstName)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.MiddleName)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.LastName)
                                            </th>
                                         @*   <th>
                                                @Html.DisplayNameFor(model=>model.identityUser .Address)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.Country)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.city)
                                            </th>*@
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.PhoneNumber)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.identityUser.Email)
                                            </th>
                                            <th>
                                                @Html.DisplayNameFor(model=>model.otherDetails.GSTNo)
                                            </th>

                                            <th>
                                                @Html.DisplayNameFor(model=>model.otherDetails.PANNo)
                                            </th>
                                           
                                          
                                            <th>
                                            @Html.DisplayNameFor(model=>model.otherDetails.BusinessType)


                                            </th>
                                            <th>
                                             Email Confirm


                                            </th>
                                           
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                            
                                                <td>

                                                    @Html.DisplayFor(modelItem=>item.identityUser.FirstName)

                                                </td>

                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.MiddleName)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.LastName)
                                                </td>
                                              @*  <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.Address)

                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.Country)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.city)
                                                </td>*@

                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.PhoneNumber)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.identityUser.Email)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.otherDetails.GSTNo)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.otherDetails.PANNo)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem=>item.otherDetails.BusinessType)
                                                 </td>
                                                 <td>
                                
                                                    @Html.DisplayFor(modelItem=>item.identityUser.EmailConfirmed)
                                                </td>
                                                <td>
                                               
                                                     @Html.ActionLink("UserDetails","GetUser", new { id = @item.identityUser.Id },new {@class="btn btn-info"})
                                                    <input type="hidden" id="inputValue" name="inputValue" value="@item.identityUser.Id" class="form-control" />
                                                    <button onclick="DisplayAlert('@item.identityUser.Id')" class="btn btn-danger">Delete</button>
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                                    Open Modal
                                </button>

                                background-image: url('/Images/SearchBarChat.png');

                                                </td>
                                            </tr>

                                        }
                                     
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    </div>

@if (TempData["SuccessMessage"] != null)
{
    <script>
        Swal.fire({
            title: 'Success!',
            text: '@TempData["SuccessMessage"]',
            icon: 'success'
        });
    </script>
}

@if (TempData["EmailsendingReconfirmationUser"] != null)
{
    <script>
        Swal.fire({
            title: 'Success!',
            text: '@TempData["EmailsendingReconfirmationUser"]',
            icon: 'success'
        });
    </script>
}


@if (TempData["EmailsendingReconfirmation"] != null)
{
    <script>
        Swal.fire({
            title: 'Success!',
            text: '@TempData["EmailsendingReconfirmation"]',
            icon: 'success'
        });
    </script>
}

@if (TempData["UpdateUserData"] != null)
{
    <script>
        Swal.fire({
            title: 'Success!',
            text: '@TempData["UpdateUserData"]',
            icon: 'success'
        });
    </script>
}


<!-- End of Page Wrapper -->
    <!-- Scroll to Top Button-->
  
    <!-- Logout Modal-->
 

    <!-- Bootstrap core JavaScript-->
@section Scripts
    {




    <script>

        var loadfile2 = function (event) {

            var output = document.getElementById('blah2');
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function () {
                URL.revokeObjectURL(output.src)

            }
        };







    </script>


    <script>

        var loadfile = function (event) {

            var output = document.getElementById('UploadAdhar');
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function () {

                URL.revokeObjectURL(output.src)
                $('#spnImgError').text("Pan  Image Upload")
            }




        };




        function DisplayAlert(id) {
            Swal.fire({
                title: 'Do you want to Delete the User Data?',
                icon: 'warning',
                showDenyButton: false,
                showCancelButton: true,
                confirmButtonText: 'Delete',
                confirmButtonClass: 'btn-danger',
                denyButtonText: `Don't Delete`,
            }).then((result) => {

                if (result.isConfirmed) {

                    var mydata = $('#inputValue').val();
                    $.ajax({
                        type: "Get",
                        url: '@Url.Action("DeleteUser", "UserDetails")',
                        data: { UserId: id },
                        success: function (data) {
                            console.log("Ajax in document ready function success");
                            console.log(mydata);

                            location.reload();
                        },
                        error: function (xhr) {
                            alert('No Valid Data');
                        }
                    });
                } else if (result.isDenied) {
                    Swal.fire('Changes are not saved', '', 'info')
                }
            });
        }


        //function uploadImage(userid) {

        //    const formData = new FormData();
        //    const fileInput = document.getElementById("UploadAdhar");
        //    const userId = userid;

        //    //const userId = document.getElementById("useridr").val;
        //    console.log(userId);





        //    formData.append("image", fileInput.files[0]);
        //    console.log(fileInput);
        //    fetch("/Upload/UploadImage", {
        //        method: "POST",
        //        body: formData, userId,
        //    })
        //        .then(response => response.json())
        //        .then(data => {
        //            if (data.success) {
        //                // console.log(data.imagePath)
        //                // Image uploaded successfully, now save the path in the database.

        //                console.log(userid);

        //                const imagePath = data.imagePath;

        //                saveImagePathToDatabase(imagePath);
        //                localStorage.setItem('userName', imagePath);
        //                console.log(imagePath);
        //                document.getElementById("UploadAdhar").src = imagePath;
        //            } else {
        //                // Handle error here
        //                console.error("Image upload failed.");
        //            }
        //        })
        //        .catch(error => {
        //            console.error("Error:", error);
        //        });

        //    // Prevent the default form submission
        //    return false;
        //}

        //function saveImagePathToDatabase(imagePath,userid) {

        //    console.log('ImagePath',imagePath);
        //    console.log('USERiD',userid);
        //    fetch("/Upload/SaveFiles", {
        //        method: "POST",
        //        headers: {
        //            "Content-Type": "application/json",
        //        },
        //        body: JSON.stringify({ imagePath: imagePath }),
        //    })
        //        .then(response => response.json())
        //        .then(data => {
        //            if (data.success) {
        //                // Image path saved in the database.
        //                console.log("Image path saved successfully.");
        //            } else {
        //                // Handle error here
        //                console.error("Image path save failed.");
        //            }
        //        })
        //        .catch(error => {
        //            console.error("Error:", error);
        //        });
        //}

        ///



    </script>


    <script>
        $(document).ready(function () {
            $('#example').DataTable();
        });
    </script>

    <script>


        $(document).ready(function () {
            console.log("Hit");

            $('#dataTableUser').DataTable({
                "processing": true,
                "serverSide": true,
                "filter": true,
                "ajax": {
                    "url": "/UserDetails/GetUserList1",
                    "type": "POST",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "firstName", "name": "FirstName" },
                    { "data": "middleName", "name": "MiddleName" },
                    { "data": "lastName", "name": "LastName" },
                    { "data": "phoneNumber", "name": "PhoneNumber" },
                    { "data": "email", "name": "Email" },
                    { "data": "gstNo", "name": "GSTNo" },
                    { "data": "panNo", "name": "PANNo" },
                    { "data": "businessType", "name": "BusinessType" },
                    {
                        "data": "confirm",
                        "name": "Confirm",
                        orderable: false,
                        "render": function (data, type, row) {

                            console.log(row);
                            if (data === true) {
                                var queryString = $.param(row);
                                var url = "/EmailSending/Email_ReConfirmation_link?" + queryString;

                                return '<a href="' + url + '" style="display: inline-block; width: 50px; height: 50px; background-image: url(\'/ImageButtuon/email_Confirmation1.png\'); background-size: cover;" tooltip=" Send Email Re-Confirmation Link " flow="up"></a>';

                            } else {
                                var queryString = $.param(row);
                                var url = "/EmailSending/Email_ReConfirmation_link?" + queryString;

                                return '<a href="' + url + '" style="display: inline-block; width: 54px; height: 55px; background-image: url(\'/ImageButtuon/NotConfirmaEmail1.png\'); background-size: cover;" tooltip="This Email Not Confirmed. Send Email Confirmation Link" flow="up"></a>';
                            }
                        }
                    },
                    {
                        "data": "id",
                        "name": "Id",
                        orderable: false,
                        "render": function (data, type, row) {
                            return '<a href="/UserDetails/GetUserView/' + data + '" class="btn btn-warning" tooltip=" User View Details" flow="up" ><i class="fa-solid fa-eye"></i></a> <button onclick="DisplayAlert(\'' + data + '\')" class="btn btn-danger" tooltip=" Delete User" flow="up"><i class="fa-solid fa-trash"></i></button><a href="/UserDetails/GetUser/' + data + '" class="btn btn-success" tooltip=" Update User Details" flow="up"><i class="fa-solid fa-pen"></i></a>';
                        }
                    }
                ]
            });
        });




    </script>



   
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>






  <link href="../../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

 @*   <!-- Custom styles for this template -->
    <link href="../../css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="../../vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <script src="../../vendor/jquery/jquery.min.js"></script>
    <script src="../../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="../../vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="../../js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="../../vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="../../vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="../../js/demo/datatables-demo.js"></script>*@
    }