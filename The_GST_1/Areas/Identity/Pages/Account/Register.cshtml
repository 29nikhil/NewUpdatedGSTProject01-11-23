@page
@model RegisterModel
@{
    ViewData["Title"] = "Register";
}

  
@{
    var emailRegexPattern = @"^(([^<> ()[\]\\.,;:\s@\""]+(\.[^<>()[\]\\.,;:\s@\""]+)*)|(\"".+\""))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$";
}

  

<style>
      .custom-file-upload {
            cursor: pointer;
            padding: 10px;
        border: 1px solid white;
            border-radius: 20px;
            background-color: forestgreen;
            display: inline-block;
        }

        .custom-file-upload:hover {
            background-color: blue;
        }



    .form2 {
        display: none;
    }


    input[type="number"] {
        -moz-appearance: textfield;
    }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

    input[type="number"] {
        -moz-appearance: textfield;
    }



    /* Add this CSS to your stylesheet or within a <style> tag in your HTML */

    /* Custom styling for Toastify */
   

</style>
   


@if (TempData["ErrorMessage"] != null)
{

    <script>
        Swal.fire({
            title: 'Fail To Register account!',
            text: '@TempData["ErrorMessage"]',
            icon: 'error'
        });
    </script>

}
<div class=" row ml-2 ml-md-auto justify-content-md-end ">
    <a class="back-button" asp-area=""  asp-controller="UserDetails" asp-action="UserList">




        <span><i class="fa-solid fa-user"></i>User List</span>
    </a>

</div>
    <div class="container-fluid">

    <div class="card o-hidden border-0 shadow-lg my-5" style="border: 4px solid black; border-radius:15px; /* Add this line to set the black border */
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    box-sizing: border-box; background-image: url('/Images/RegistorBackGround4.jpg'); background-size: cover; ">
        <div class="MiddleLine"></div>
            <div class="card-body p-0">
                <!-- Nested Row within Card Body -->
                <div class="row">

                    <div class="col-lg-12">
                        <div class="p-5">
                           
                            <h1 class="Nameheader"><b>Add User</b></h1>
                           
                            <form class="user"   id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post" enctype="multipart/form-data">
                            <div class="form-group row">
                                <div class="profile-pic" style="margin:auto;">
                                    <label class="-label" for="file">
                                        <span class="glyphicon glyphicon-camera"></span>
                                        <span>Change Image</span>
                                    </label>
                                    <input id="file" type="file" onchange="loadFile(event)" />
                                    <img src="https://images.pexels.com/photos/19055796/pexels-photo-19055796/free-photo-of-brunette-in-leather-jacket-posing-at-subway-station.jpeg?auto=compress&cs=tinysrgb&w=600&lazy=load" id="output" width="200" />
                                </div>
                            </div>
                            <div class="form1" >


                               
                                <div class="form-group row">
                                    <div class="col-sm-4 mb-3 mb-sm-0">
                                        @*  <input type="text" class="form-control form-control-user" id="exampleFirstName"
                                        placeholder="First Name">
                                        *@

                                        <div class="input_box">
                                            <div class="lablesForm">First Name:</div>

                                            <input asp-for="Input.FirstName" pattern="[A-Za-z]+" id="exampleFirstName"
                                                   placeholder="Enter First Name" />
                                        </div>

                                        <span asp-validation-for="Input.FirstName" id="FirstNameError" class="text-danger"></span>
                                       

                                    </div>
                                    <div class="col-sm-4">
                                        <div class="input_box">
                                            <div class="lablesForm">Middle Name:</div>

                                            <input asp-for="Input.MiddleName" pattern="[A-Za-z]+" id="exampleMiddleName"
                                                   placeholder="Enter Middel Name" />
                                        </div>
                                        
                                        <span asp-validation-for="Input.MiddleName" id="MiddleNameError" class="text-danger"></span>
                                    </div>
                                    <div class="col-sm-4 mb-6 mb-sm-0">
                                        @*  <input type="text" class="form-control form-control-user" id="exampleFirstName"
                                        placeholder="First Name">
                                        *@
                                        <div class="input_box">
                                            <div class="lablesForm">Last Name:</div>

                                            <input asp-for="Input.LastName" pattern="[A-Za-z]+" id="exampleLastName"
                                                   placeholder="Enter Last Name" />
                                        </div>

                                        <span asp-validation-for="Input.LastName" id="LastNameError" class="text-danger"></span>

                                    </div>
                                </div>
                                <div class="form-group row">

                                    <div class="col-sm-6">
                                        <div class="input_box">
                                            <div class="lablesForm">Phone No:</div>

                                            <input type="number" asp-for="Input.PhoneNumber" id="examplePhoneName"
                                                   placeholder="Enter Phone No"  oninput="restrictLength(this,10)" />
                                        </div>

                                        <span asp-validation-for="Input.PhoneNumber" id="PhoneNumberError" class="text-danger"></span>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="input_box">
                                            <div class="lablesForm">Email:</div>

                                            <input asp-for="Input.Email" id="emailInput" onkeyup="checkEmail()"
                                                   placeholder="Enter Email Address" />
                                        </div>

                                        <span asp-validation-for="Input.Email" id="EmailError" class="text-danger"></span>
                                        <div style="margin-left:10px;" id="resultMessage"></div>


                                    </div>



                                </div>



                                <div class="form-group row">
                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        <div class="input_box">
                                            <div class="lablesForm">City:</div>

                                            <input asp-for="Input.City" id="exampleCityName"
                                                   placeholder=" Enter City" />
                                        </div>

                                        <span asp-validation-for="Input.City" id="CityError" class="text-danger"></span>

                                    </div>
                                    <div class="col-sm-6">
                                        <div class="input_box">
                                            <div class="lablesForm">Country:</div>

                                            <select asp-for="Input.Country" id="exampleCountry" placeholder="Country">
                                                <option value="" selected disabled>Please select Country</option>
                                                <option value="India">India</option>
                                                <option value="Bharat">Bharat</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>

                                        <span asp-validation-for="Input.Country" id="CountryError" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-12 ">
                                        <div class="input_box">
                                            <div class="lablesForm">Address:</div>

                                            <input asp-for="Input.Address" id="exampleAddress"
                                                   placeholder="Enter Address" />
                                        </div>

                                        <span asp-validation-for="Input.Address" id="AddressError" class="text-danger"></span>


                                    </div>
                                </div>
                                <div class="form-group row">

                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        <div class="input_box">

                                            <div class="lablesForm">Password:</div>

                                            <input asp-for="Input.Password"
                                                   id="exampleInputPassword" placeholder="Password" />
                                        </div>
                                        <span asp-validation-for="Input.Password" id="PasswordError" class="text-danger"></span>

                                        @*  <input type="password" class="form-control form-control-user"
                                        id="exampleInputPassword" placeholder="Password">*@
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="input_box">

                                            <div class="lablesForm">Confirm Password:</div>

                                            <input asp-for="Input.ConfirmPassword"
                                                   id="exampleRepeatPassword" placeholder="Repeat Password" />
                                        </div>
                                        <span asp-validation-for="Input.ConfirmPassword" id="ConfirmPasswordError" class="text-danger"></span>
                                        @*<input type="password" class="form-control form-control-user"
                                        id="exampleRepeatPassword" placeholder="Repeat Password">*@
                                    </div>

                                </div>

                                <div style="margin-left:80%;">
                                    <button type="button" id="nextButton"  class="custom-btn btn-1">Next</button>

                                </div>
                            </div>
                           


                            <div class="form2" id="section2">
                                <div class="form-group row">

                                    <div class="col-sm-6">
                                        <div class="input_box">
                                            <div class="lablesForm">Gst No:</div>
                                            <input asp-for="Input.GSTNo" id="Gstno" onkeyup="checkGstNo()"
                                                   placeholder="Enter GST No" />
                                        </div>

                                        <span asp-validation-for="Input.GSTNo" class="text-danger"></span>
                                        <div id="resultMessage1"></div>
                                    </div>



                                    <div class="col-sm-6 mb-3 mb-sm-0">


                                        <div class="input_box">
                                            <div class="lablesForm">BusinessType:</div>
                                            <select asp-for="Input.BusinessType" id="exampleBusinessType" placeholder="Country">
                                                <option value="" selected disabled>Please select Buiness Type</option>
                                                <option value="Organization">Organization</option>
                                                <option value="Individual">Individual</option>

                                            </select>
                                        </div>


                                        <span asp-validation-for="Input.BusinessType" class="text-danger"></span>

                                    </div>

                                </div>

                                <input type="hidden" asp-for="Input.Roles" autocomplete="new-password" value="User" aria-required="true" />

                                <div class="form-group row">

                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        <div class="input_box">
                                            <div class="lablesForm">PAN No:</div>
                                            <input asp-for="Input.PANNo" id="examplePANNo"
                                                   placeholder="Enter Pan Card No" oninput="restrictLength(this,10)" />
                                        </div>

                                        <span asp-validation-for="Input.PANNo" class="text-danger"></span>

                                    </div>
                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        @*  <input type="text" class="form-control form-control-user" id="exampleFirstName"
                                        placeholder="First Name">
                                        *@
                                        <div class="input_box">
                                            <div class="lablesForm">Adhar No:</div>
                                            <input type="number" asp-for="Input.AdharNo" id="exampleAdharNo" oninput="restrictLength(this, 12)"
                                                   placeholder="Enter Adhar Card No" />
                                        </div>

                                        <span asp-validation-for="Input.AdharNo" class="text-danger"></span>

                                    </div>

                                </div>

                                <div class="form-group row">

                                    <div class="col-sm-12">
                                        <div class="input_box">
                                            <div class="lablesForm">Web-site:</div>
                                            <input asp-for="Input.website" id="examplewebsite"
                                                   placeholder="Enter Web-Site" />
                                        </div>

                                        <span asp-validation-for="Input.website" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <div class="col-sm-4 mb-3 mb-sm-3">
                                        <p><b>Please select jpg, jpeg & pdf file only.</b></p>

                                        <label for="fileAdharInput" class="custom-file-upload" style="color:white; -webkit-text-stroke-color:black; width:200px;" tooltip="Click On Upload File." flow="up">
                                            <i class="fas fa-cloud-upload-alt"></i> Upload Adhar-Card
                                        </label>
                                        <input type="file" asp-for="Input.UploadAdharPath" id="fileAdharInput" style="display: none;" accept=".pdf, .jpg, .jpeg" />
                                        <div id="fileNameAdharDisplay" style="color:forestgreen; font-size: revert;"><p style="color:red"> Not Select File</p></div>
                                    </div>


                                    <div class="col-sm-4 mb-3 mb-sm-0">
                                        <p><b>Please select jpg, jpeg & pdf file only.</b></p>

                                        <label for="fileInput" class="custom-file-upload" style="color:white; -webkit-text-stroke-color:black; width:200px;" tooltip="Click On Upload File." flow="up">
                                            <i class="fas fa-cloud-upload-alt"></i> Upload Pan-Card
                                        </label>
                                        <input type="file" asp-for="Input.UploadPanPath" id="fileInput" style="display: none;" accept=".pdf, .jpg, .jpeg" />
                                        <div id="fileNameDisplay" style="color:forestgreen; font-size: revert;"><p style="color:red"> Not Select File</p></div>
                                    </div>
                                </div>

                                <div class="row">
                                    <button type="button" class="custom-btn btn-1" onclick="showPreviousForm()">Back</button>

                                    <div style="margin-left: auto;">
                                        <button id="registerButton" type="submit" class="custom-btn btn-1" tooltip="Click On this Button Register." flow="up">Add User</button>
                                    </div>
                                </div>


                            </div>  
                           
                         


                               @* <a href="login.html" class="btn btn-primary btn-user btn-block">
                                    Register Account
                                </a>*@
                                <hr>
                            </form>
                            <hr>
                            
                            <div class="text-center">
                                  @*     <a class="small" id="login" asp-area="Identity" asp-page="/Account/Login">Already have an account? Login!</a>*@

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="MiddleLine"></div>
        </div>
    
    </div>

    <!-- Bootstrap core JavaScript-->
   
    @section Scripts {
     <partial name="_ValidationScriptsPartial" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var nextButton = document.getElementById('nextButton');

            nextButton.addEventListener('click', function () {
                // Perform null check for all fields in the current form
                var FirstName = document.getElementById('exampleFirstName').value;
                var MiddleName = document.getElementById('exampleMiddleName').value;

                var LastName = document.getElementById('exampleLastName').value;
                var PhoneNo = document.getElementById('examplePhoneName').value;
                var Email = document.getElementById('emailInput').value;
                var City = document.getElementById('exampleCityName').value;
                var Country = document.getElementById('exampleCountry').value;
                var Address = document.getElementById('exampleAddress').value;
                var Password = document.getElementById('exampleInputPassword').value;
                var Repassword = document.getElementById('exampleRepeatPassword').value;

                var errorMessage = '';

                if (!FirstName) {
                    errorMessage= 'First Name is required.\n';
                    
                    var errorContainer = document.getElementById('FirstNameError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!MiddleName) {
                    errorMessage = 'Middle Name is required.\n';
                    var errorContainer = document.getElementById('MiddleNameError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!LastName) {
                    errorMessage = 'Last Name is required.\n';

                    var errorContainer = document.getElementById('LastNameError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;


                }
                if (!PhoneNo) {
                    errorMessage = 'Phone Number is required.\n';
                    var errorContainer = document.getElementById('PhoneNumberError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!Email) {
                    errorMessage = 'Email is required.\n';
                    var errorContainer = document.getElementById('EmailError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!City) {
                    errorMessage = 'City is required.\n';
                    var errorContainer = document.getElementById('CityError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!Country) {
                    errorMessage = 'Country is required.\n';
                    var errorContainer = document.getElementById('CountryError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!Address) {
                    errorMessage = 'Address is required.\n';
                    var errorContainer = document.getElementById('AddressError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!Password) {
                    errorMessage = 'Password is required.\n';
                    var errorContainer = document.getElementById('PasswordError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }
                if (!Repassword) {
                    errorMessage = 'Repeat Password is required.\n';
                    var errorContainer = document.getElementById('ConfirmPasswordError');
                    errorContainer.innerHTML = errorMessage === '' ? '' : errorMessage;
                }

                if (errorMessage !== '') {
                    Toastify({
                        text: "All Filed is required. please Enter all Files",
                        duration: 4000, // duration in milliseconds
                        gravity: 'up', // 'top' or 'bottom'
                        position: 'right', // 'left', 'center', or 'right'
                        backgroundColor: 'red',
                    }).showToast();
                } else {
                    // Proceed to the next form
                    showNextForm();
                }

            });

           
        });


        document.getElementById('registerButton').addEventListener('click', function () {
            // Get form fields
            var BusinessType = document.getElementById('exampleBusinessType').value;
            var PanNo = document.getElementById('examplePANNo').value;
            var AdharNo = document.getElementById('exampleAdharNo').value;
            var Website = document.getElementById('examplewebsite').value;
            var GstNo = document.getElementById('Gstno').value;
            var AdharFile = document.getElementById('fileAdharInput').value;
            var PanFile = document.getElementById('fileInput').value;

            // Check for null or empty values
            if (!BusinessType || !PanNo || !AdharNo || !Website || !GstNo || !AdharFile || !PanFile) {
                // Display error message
                Toastify({
                    text: "All fields are required. Please enter all fields.",
                    duration: 4000, // duration in milliseconds
                    gravity: 'top', // 'top' or 'bottom'
                    position: 'right', // 'left', 'center', or 'right'
                    backgroundColor: 'red',
                    style: {
                        top: '-100px', // Adjust this value based on your desired top margin
                    },
                }).showToast();
            } else {
                // Proceed to the next form
                showNextForm();
            }
        });




        function showNextForm() {
            const form1 = document.querySelector('.form1');



            const form2 = document.querySelector('.form2');

            form1.style.display = 'none';
            form2.style.display = 'block';
        }

        function showPreviousForm() {
            const form1 = document.querySelector('.form1');
            const form2 = document.querySelector('.form2');

            form1.style.display = 'block';
            form2.style.display = 'none';
        }
    </script>

<script type="text/javascript">

        var isValidPdfAadharFile = false;
        var isValidPdfPANFile = false;

        document.getElementById('fileAdharInput').addEventListener('change', function () {
            const fileInput = this;
            const errorContainer = document.getElementById('fileNameAdharDisplay');
            var submitButton = document.getElementById("registerButton");

            // Check if a file was selected
            if (fileInput.files.length > 0) {
                const selectedFile = fileInput.files[0];
                const validExtensions = ['.pdf', '.jpg', '.jpeg']; // Separate extensions with commas

                const fileExtension = selectedFile.name.split('.').pop().toLowerCase();
                const isValidExtension = validExtensions.includes('.' + fileExtension);

                if (!isValidExtension) {
                    $('#fileNameAdharDisplay').text('Please select a valid pdf, jpg, or jpeg file.').css('color', 'red');
                    isValidPdfAadharFile = false;

                    if (isValidPdfAadharFile == false || isValidPdfPANFile == false) {
                        submitButton.disabled = true;
                        fileInput.value = ''; // Clear the file input
                    }
                } else {
                    if (fileInput.files.length > 0) {
                        console.log("after file name displayed");
                        $('#fileNameAdharDisplay').text("Selected File: " + fileInput.files[0].name).css('color', 'green');
                        isValidPdfAadharFile = true;

                        if (isValidPdfAadharFile == true && isValidPdfPANFile == true) {
                            submitButton.disabled = false;
                        }
                    } else {
                        $('#fileNameAdharDisplay').text('No file selected').css('color', 'red');
                    }
                }
            }
        });

        document.getElementById('fileInput').addEventListener('change', function () {
            const fileInput = this;
            const errorContainer = document.getElementById('fileNameDisplay');
            var submitButton = document.getElementById("registerButton");

            // Check if a file was selected
            if (fileInput.files.length > 0) {
                const selectedFile = fileInput.files[0];
                const validExtensions = ['.pdf', '.jpg', '.jpeg']; // Separate extensions with commas

                const fileExtension = selectedFile.name.split('.').pop().toLowerCase();
                const isValidExtension = validExtensions.includes('.' + fileExtension);

                if (!isValidExtension) {
                    $('#fileNameDisplay').text('Please select a valid pdf, jpg, or jpeg file.').css('color', 'red');
                    isValidPdfPANFile = false;

                    if (isValidPdfAadharFile == false || isValidPdfPANFile == false) {
                        submitButton.disabled = true;
                        fileInput.value = ''; // Clear the file input
                    }
                } else {
                    if (fileInput.files.length > 0) {
                        console.log("after file name displayed");
                        $('#fileNameDisplay').text("Selected File:" + fileInput.files[0].name).css('color', 'green');
                        isValidPdfPANFile = true;

                        if (isValidPdfAadharFile == true && isValidPdfPANFile == true) {
                            submitButton.disabled = false;
                        }
                    } else {
                        $('#fileNameDisplay').text('No file selected').css('color', 'red');
                    }
                }
            }
        });






        function displayFileNameAdhar(input) {

            const fileNameDisplay = document.getElementById("fileNameAdharDisplay");
           
            if (input.files.length > 0) {
                fileNameDisplay.textContent = "Selected File: " + input.files[0].name;
                document.getElementById("pdfAdhar").innerHTML
               
            } else {
                fileNameDisplay.textContent = "No file selected";
            }
        }

        function displayFileName(input) {
            const fileNameDisplay = document.getElementById("fileNameDisplay");

            if (input.files.length > 0) {
                fileNameDisplay.textContent = "Selected File: " + input.files[0].name;
                document.getElementById("pdfAdhar").innerHTML

            } else {
                fileNameDisplay.textContent = "No file selected";
            }
        }



     


            function checkEmail() {
                var email = document.getElementById('emailInput').value.trim();
                var submitButton = document.getElementById("registerButton");


                if (email) {



                    $.ajax({
                        type: 'POST',
                        url: '/UserDetails/CheckEmail',
                        data: { email: email },
                        success: function (result) {
                            console.log(result);
                            if (result) {
                                $('#resultMessage').text('Email is available.').css('color', 'green');
                                submitButton.disabled = false;

                            } else {
                                $('#resultMessage').text('This email is already taken. Please enter a new email.').css('color', 'red');
                                submitButton.disabled = true;
                            }
                        },
                        error: function (error) {
                            console.error('Error:', error);
                        }
                    });
                }
                else {

                    $('#resultMessage').text('').css('color', 'red');

                }
            }




        function checkGstNo() {
            var GstNo = document.getElementById('Gstno').value.trim();
            var submitButton = document.getElementById("registerButton");

            if (GstNo) {

                console.log(GstNo);

                $.ajax({
                    type: 'POST',
                    url: '/UserDetails/CheckGstNo',
                    data: { GstNo: GstNo },
                    success: function (result) {
                        console.log(result);
                        if (result) {
                            $('#resultMessage1').text('').css('color', 'green');
                            submitButton.disabled = false;

                        } else {
                            $('#resultMessage1').text('This Gst no is already Exist. Please Uniqe Gst No Enter.').css('color', 'red');
                            submitButton.disabled = true;

                        }
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            }
            else {

                $('#resultMessage').text('').css('color', 'red');

            }
        }


            function restrictLength(input, maxLength) {
                const value = input.value.toString(); // Convert the numeric value to a string
                if (value.length > maxLength) {
                    input.value = value.slice(0, maxLength); // Trim the value to the maximum length
                }
            }

        var loadFile = function (event) {
            var image = document.getElementById("output");
            image.src = URL.createObjectURL(event.target.files[0]);
        };


</script>
  




}




